"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Dsn=exports.log=exports.init=void 0;function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _typeof(a){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}var _event,_dsn,_url,defaultUrl="https://stage-api.workerlog.dev/log",usernameRegEx=/^[0-9A-Fa-f]{40}$/,projectRegEx=/^[0-9A-Fa-f]{7}$/,hostnane="workerlog.dev",headers={"User-Agent":"Workerlog/1.0 (https://workerlog.dev)","Content-Type":"application/json"// global variable to keep track of fetch event
},init=function(a,b){var c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:defaultUrl;if(!a||"fetch"!==a.type)throw"workerlog: fetch event is required";_dsn=new Dsn(b),_url=new URL(c),_event=a};exports.init=init;var log=function(){if(!_event||"fetch"!=_event.type)throw"workerlog: fetch event is required. please setup fetch event using init()";_event.waitUntil(sendlog.apply(void 0,arguments))};exports.log=log;var sendlog=function(){for(var a=[],b=arguments.length,c=Array(b),d=0;d<b;d++)c[d]=arguments[d];for(var e,f=0,g=c;f<g.length;f++)switch(e=g[f],console.log(_typeof(e)),_typeof(e)){case"string":a.push({t:"string",v:e});break;case"number":a.push({t:"number",v:e});break;case"boolean":a.push({t:"boolean",v:e});break;case"object":a.push({t:"object",v:e});break;case"array":a.push({t:"string",v:e});break;default:a.push({t:"other",v:e});}var h=JSON.stringify({dsn:_dsn.toString(),ts:new Date().toISOString(),msg:a});return fetch(_url.toString(),{method:"POST",headers:headers,body:h})},Dsn=/*#__PURE__*/function(){function a(b){_classCallCheck(this,a);var c=new URL(b);if(this._username=c.username,this._hostname=c.hostname,this._project=c.pathname.replace(/^\//,""),!this.isValid())throw"invalid dsn"}return _createClass(a,[{key:"toString",value:function toString(){return"https://".concat(this._username,"@").concat(this._hostname,"/").concat(this._project)}},{key:"isValid",value:function isValid(){return usernameRegEx.test(this._username)&&projectRegEx.test(this._project)&&hostnane===this._hostname}}]),a}();exports.Dsn=Dsn;